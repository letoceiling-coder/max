# –õ–∏–º–∏—Ç—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Max Bot API

–í—Å–µ –∫–ª–∞—Å—Å—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ Max API.

## üìù –¢–µ–∫—Å—Ç–æ–≤—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –°–æ–æ–±—â–µ–Ω–∏—è
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è**: 4096 —Å–∏–º–≤–æ–ª–æ–≤
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —á–∞—Ç–∞**: 255 —Å–∏–º–≤–æ–ª–æ–≤
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –æ–ø–∏—Å–∞–Ω–∏—è —á–∞—Ç–∞**: 1000 —Å–∏–º–≤–æ–ª–æ–≤

### –ö–Ω–æ–ø–∫–∏
- **–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏**: –¥–æ 256 —Å–∏–º–≤–æ–ª–æ–≤
- **URL –≤ –∫–Ω–æ–ø–∫–µ**: –¥–æ 2048 —Å–∏–º–≤–æ–ª–æ–≤
- **Callback payload**: –¥–æ 4096 –±–∞–π—Ç

## ‚å®Ô∏è –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞

### –õ–∏–º–∏—Ç—ã –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
- **–ú–∞–∫—Å–∏–º—É–º –∫–Ω–æ–ø–æ–∫**: 210 (–≤—Å–µ–≥–æ –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ)
- **–ú–∞–∫—Å–∏–º—É–º —Ä—è–¥–æ–≤**: 30
- **–ú–∞–∫—Å–∏–º—É–º –∫–Ω–æ–ø–æ–∫ –≤ —Ä—è–¥—É**: 7
- **–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –≤ —Ä—è–¥—É**: –¥–æ 3 (–¥–ª—è link, open_app, request_geo_location, request_contact)

### –¢–∏–ø—ã –∫–Ω–æ–ø–æ–∫

1. **callback** - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ message_callback
2. **link** - –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Å—ã–ª–∫—É –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
3. **request_contact** - –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. **request_geo_location** - –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é
5. **open_app** - –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
6. **message** - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É

## üìÅ –§–∞–π–ª—ã

- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞**: 20 MB

## ‚ö° Rate Limits

- **–ú–∞–∫—Å–∏–º—É–º –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É**: ~20
- **–ú–∞–∫—Å–∏–º—É–º —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É –¥–ª—è –æ–¥–Ω–æ–≥–æ —á–∞—Ç–∞**: 1

## üö® HTTP –∫–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤

- `200` ‚Äî —É—Å–ø–µ—à–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
- `400` ‚Äî –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å
- `401` ‚Äî –æ—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `404` ‚Äî —Ä–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω
- `405` ‚Äî –º–µ—Ç–æ–¥ –Ω–µ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è
- `429` ‚Äî –ø—Ä–µ–≤—ã—à–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- `503` ‚Äî —Å–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

## ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

–í—Å–µ –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è:

```php
use App\Max\Max;
use App\Max\Exceptions\MaxValidationException;

try {
    // –°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
    Max::send(123456789, str_repeat('A', 5000));
} catch (MaxValidationException $e) {
    echo $e->getMessage();
    // "Message text is too long (5000 characters). Maximum: 4096"
}
```

## üõ†Ô∏è –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã

### –û–±—Ä–µ–∑–∫–∞ —Ç–µ–∫—Å—Ç–∞

```php
use App\Max\Validator;

$text = str_repeat('A', 5000);
$truncated = Validator::truncateText($text, 4096);
```

### –†–∞–∑–±–∏–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞

```php
$longText = file_get_contents('long_article.txt');
$messages = Validator::splitLongText($longText);

foreach ($messages as $message) {
    max_send(123456789, $message);
}
```

## üé® –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞

### Markdown

```php
max_send($chatId, '**–ñ–∏—Ä–Ω—ã–π** *–∫—É—Ä—Å–∏–≤* ~~–∑–∞—á–µ—Ä–∫–Ω—É—Ç—ã–π~~', [
    'format' => 'markdown'
]);
```

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–µ–≥–∏:
- `*–∫—É—Ä—Å–∏–≤*` –∏–ª–∏ `_–∫—É—Ä—Å–∏–≤_`
- `**–∂–∏—Ä–Ω—ã–π**` –∏–ª–∏ `__–∂–∏—Ä–Ω—ã–π__`
- `~~–∑–∞—á—ë—Ä–∫–Ω—É—Ç—ã–π~~`
- `++–ø–æ–¥—á—ë—Ä–∫–Ω—É—Ç—ã–π++`
- `` `–º–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π` ``
- `[—Å—Å—ã–ª–∫–∞](https://example.com)`
- `[User mention](max://max.ru/%user_id%)`

### HTML

```php
max_send($chatId, '<b>–ñ–∏—Ä–Ω—ã–π</b> <i>–∫—É—Ä—Å–∏–≤</i> <del>–∑–∞—á–µ—Ä–∫–Ω—É—Ç—ã–π</del>', [
    'format' => 'html'
]);
```

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–µ–≥–∏:
- `<i>` –∏–ª–∏ `<em>` - –∫—É—Ä—Å–∏–≤
- `<b>` –∏–ª–∏ `<strong>` - –∂–∏—Ä–Ω—ã–π
- `<del>` –∏–ª–∏ `<s>` - –∑–∞—á—ë—Ä–∫–Ω—É—Ç—ã–π
- `<ins>` –∏–ª–∏ `<u>` - –ø–æ–¥—á—ë—Ä–∫–Ω—É—Ç—ã–π
- `<pre>` –∏–ª–∏ `<code>` - –º–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π
- `<a href="url">` - —Å—Å—ã–ª–∫–∞
- `<a href="max://max.ru/%user_id%">` - —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üìã –ü—Ä–∏–º–µ—Ä—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è

```php
try {
    Max::send(123456789, ''); // ‚ùå –û—à–∏–±–∫–∞
} catch (MaxValidationException $e) {
    // "Message text cannot be empty"
}

try {
    Max::send(123456789, str_repeat('A', 5000)); // ‚ùå –°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π
} catch (MaxValidationException $e) {
    // "Message text is too long (5000 characters). Maximum: 4096"
}
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã

```php
$keyboard = max_keyboard();

try {
    // –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∫–Ω–æ–ø–æ–∫ –≤ —Ä—è–¥—É
    $keyboard->row();
    for ($i = 0; $i < 10; $i++) {
        $keyboard->callback("–ö–Ω–æ–ø–∫–∞ {$i}", "btn{$i}");
    }
    $keyboard->get(); // ‚ùå –û—à–∏–±–∫–∞
} catch (MaxValidationException $e) {
    // "Too many buttons in row..."
}

try {
    // –°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π URL
    $keyboard->row()
        ->link('–°–∞–π—Ç', str_repeat('https://example.com/', 100)); // ‚ùå –û—à–∏–±–∫–∞
} catch (MaxValidationException $e) {
    // "Button URL is too long..."
}
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞

```php
try {
    max_send(123456789, '–¢–µ–∫—Å—Ç', [
        'format' => 'invalid' // ‚ùå –û—à–∏–±–∫–∞
    ]);
} catch (MaxValidationException $e) {
    // "Invalid format: invalid. Allowed: markdown, html"
}

// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
max_send(123456789, '**–¢–µ–∫—Å—Ç**', ['format' => 'markdown']);
max_send(123456789, '<b>–¢–µ–∫—Å—Ç</b>', ['format' => 'html']);
```

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

```php
use App\Max\Exceptions\MaxValidationException;

try {
    max_send($chatId, $message);
} catch (MaxValidationException $e) {
    Log::error('Max validation error: ' . $e->getMessage());
}
```

### 2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã

```php
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–µ–∑–∫–∞
$text = Validator::truncateText($longText, 4096);
max_send($chatId, $text);

// –†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π
$messages = Validator::splitLongText($longText);
foreach ($messages as $message) {
    max_send($chatId, $message);
}
```

### 3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—á–µ—Ä–µ–¥–∏ –¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫

```php
use App\Jobs\Max\SendBroadcastJob;

SendBroadcastJob::dispatch('–í–∞–∂–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ');
```

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [README.md](README.md) - –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Max](https://dev.max.ru/docs-api)
- [Swagger —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è](https://dev.max.ru/docs-api) (swagger.json)

